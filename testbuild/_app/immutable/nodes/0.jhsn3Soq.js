import{c as E,a as M}from"../chunks/CSdnDTRN.js";import"../chunks/BZCHWgHO.js";import{a0 as L,a1 as S,a2 as X}from"../chunks/DEIVOf_J.js";import{s as Y}from"../chunks/F0xwLfuy.js";import{i as I}from"../chunks/DcpvlOCs.js";import{s as _,a as D}from"../chunks/BIiTWDcq.js";import{o as A,a as P}from"../chunks/Tju6ovFx.js";import{c as N,d as $,s as d,a as B}from"../chunks/DA317_aI.js";const W=!0,R=W;function G(b,p){L(p,!1);const[k,h]=_(),v=()=>D(B,"$controlStore",k);let i,a=new Map;A(()=>{i=document.getElementById("app-root"),i&&R&&(i.addEventListener("pointerdown",m),i.addEventListener("pointermove",f),i.addEventListener("pointerup",l),i.addEventListener("pointercancel",l),window.addEventListener("contextmenu",t=>t.preventDefault())),N()}),P(()=>{i&&(i.removeEventListener("pointerdown",m),i.removeEventListener("pointermove",f),i.removeEventListener("pointerup",l),i.removeEventListener("pointercancel",l),i.removeEventListener("contextmenu",t=>t.preventDefault()),$())});function m(t){t.preventDefault();let e=t.target,s=e.closest("#keyboard .t_key"),o=e.closest(".t_knob");if(console.log("handling pointer down"),s){console.log("here"),a.set(t.pointerId,{element:s,type:"key"});const r=s.id;u(c(r))}else if(o){const r=o.id;let n=v()[r]||0;a.set(t.pointerId,{element:o,type:"knob",startX:t.clientX,startY:t.clientY,orgCC:n}),console.log("knob value:"+n)}}function f(t){var s;let e=a.get(t.pointerId);if(e){if(e.type==="key"){let o=(s=document.elementFromPoint(t.clientX,t.clientY))==null?void 0:s.closest("#keyboard .t_key");o&&o!==e.element&&(y(c(e.element.id)),e.element=o,u(c(o.id)))}else if(e.type==="knob"&&e.startX!==void 0&&e.startY!==void 0){let o=t.clientX-e.startX,r=t.clientY-e.startY;e.swypeAxis||(Math.abs(r)>3&&Math.abs(o)<3?e.swypeAxis="Y":Math.abs(o)>3&&Math.abs(r)<3&&(e.swypeAxis="X"));let n=(e==null?void 0:e.orgCC)??0,C=n;e.swypeAxis==="Y"?n=Math.round(n-r/2):e.swypeAxis==="X"&&(n=Math.round(n-o/10)),n=Math.max(0,Math.min(127,n)),console.log("new CC:"+n),n!=C&&w(e.element.id,n)}}}function w(t,e){let s=t.replace("cc_",""),o=Number(e).toString(16).padStart(2,"0"),r="0xB0"+s+o;d(r)}function l(t){let e=a.get(t.pointerId);e&&(e.type==="key"&&y(c(e.element.id)),a.delete(t.pointerId))}function c(t){return t.substring(4)}function u(t){console.log("Playing note "+t);const e="0x90"+t+"80";d(e)}function y(t){console.log("Stopping note "+t);const e="0x80"+t+"00";d(e)}I();var g=E(),x=S(g);Y(x,p,"default",{}),M(b,g),X(),h()}export{G as component};
